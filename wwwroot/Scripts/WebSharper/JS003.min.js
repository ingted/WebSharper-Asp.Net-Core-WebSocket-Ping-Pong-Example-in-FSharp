(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;b=a.JS003=a.JS003||{};c=b.Client=b.Client||{};d=b.CommbusSite=b.CommbusSite||{};e=b.Site=b.Site||{};f=a.JS003_Templates=a.JS003_Templates||{};g=a.WebSharper;h=g&&g.Concurrency;i=g&&g.Remoting;j=i&&i.AjaxRemotingProvider;k=g&&g.UI;l=k&&k.Var$1;m=k&&k.Templating;n=m&&m.Runtime;o=n&&n.Server;p=o&&o.ProviderBuilder;q=o&&o.Handler;r=o&&o.TemplateInstance;s=a.console;t=g&&g.AspNetCore;u=t&&t.WebSocket;v=u&&u.Client;w=v&&v.WithEncoding;x=a.JSON;y=g&&g.ClientSideJson;z=y&&y.Provider;A=k&&k.Doc;B=g&&g.Runtime;C=k&&k.Client;D=C&&C.Templates;c.Main$59$20=function(E){return function(F){var G;h.StartImmediate((G=null,h.Delay(function(){return h.Bind((new j.New()).Async("JS003:JS003.Server.DoSomething:-1027172111",[F.Vars.Hole("texttoreverse").$1.Get()]),function(H){E.Set(H);return h.Zero();});})),null);};};c.Main=function(){var E,F,G,H,I,J,K;E=l.Create$1("");return(F=(G=E.get_View(),(H=(I=new p.New$1(),(I.h.push(q.EventQ2(I.k,"onsend",function(){return I.i;},function(L){var M;h.StartImmediate((M=null,h.Delay(function(){return h.Bind((new j.New()).Async("JS003:JS003.Server.DoSomething:-1027172111",[L.Vars.Hole("texttoreverse").$1.Get()]),function(N){E.Set(N);return h.Zero();});})),null);})),I)),(H.h.push({$:2,$0:"reversed",$1:G}),H))),(J=q.CompleteHoles(F.k,F.h,[["texttoreverse",0,null]]),(K=new r.New(J[1],f.mainform(J[0])),F.i=K,K))).get_Doc();};c.serverOp=a.ignore;c.prop=function(E,F,G){var H;H=null;return h.Delay(function(){s.log("websocket recieved:");s.log(G);return G.$==0?(E.Post("pong"),h.Return("pong")):G.$==2?(E.Post("mega killed"),h.Return("connected")):h.Return("diconnected");});};c.initState=function(E){return"connected";};c.ws=function(E,F,G,H){var I;function J(K,L,M){var N;N=null;return h.Delay(function(){return h.Return([K(M),function(O){return function(P){var Q;Q=null;return h.Delay(function(){return((L(M))(O))(P);});};}]);});}h.Start((I=null,h.Delay(function(){return h.Bind(w.ConnectStateful(function(K){return x.stringify(((z.Id())())(K));},function(K){return((z.Id())())(x.parse(K));},E,function(K){return J(F,G,K);}),function(K){H(K);return h.Zero();});})),null);return A.Element("pre",[],[]);};d.get_Sitelet$43$74=function(E){return c.ws(E,c.initState,B.Curried3(c.prop),function(F){c.serverOp(F);});};e.Main$129$78=function(E){return c.ws(E,c.initState,B.Curried3(c.prop),function(F){c.serverOp(F);});};f.mainform=function(E){D.LoadLocalTemplates("main");return E?D.NamedTemplate("main",{$:1,$0:"mainform"},E):void 0;};}(self));
